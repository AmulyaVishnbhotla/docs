#!/bin/bash

ret=0

# run linkchecker and print only URL, Parent URL, and Result only if Error
while IFS= read -r line; do
    if [[ $line =~ ^URL ]]; then
        output=$line
    elif [[ $line =~ ^Parent ]]; then
        output="$output\n$line"
    elif [[ $line =~  ^Result.*Error.* ]]; then
        output="$output\n$line\n"
        echo -e "$output"
        ret=1
    fi
done <<< "$(linkchecker --no-warnings --recursion-level=1 "$1" 2>/dev/null)"

exit $ret
